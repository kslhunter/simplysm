{
  "version": 3,
  "sources": ["../../../src/components/overlay/dropdown-popup.tsx"],
  "sourcesContent": ["import \"@simplysm/core-common\";\nimport {\n  type JSX,\n  type ParentComponent,\n  Show,\n  splitProps,\n  createMemo,\n  createEffect,\n  onCleanup,\n} from \"solid-js\";\nimport { Portal } from \"solid-js/web\";\nimport { tabbable } from \"tabbable\";\nimport {\n  backdrop,\n  dropdownPopup,\n  dropdownPopupContent,\n  mobileHandle,\n} from \"./dropdown-popup.css\";\nimport { useDropdownInternal } from \"./dropdown-context\";\n\n/**\n * DropdownPopup \uCEF4\uD3EC\uB10C\uD2B8\uC758 props\n *\n * JSX.HTMLAttributes<HTMLDivElement>\uB97C \uD655\uC7A5\uD558\uC5EC\n * \uD45C\uC900 div \uC18D\uC131\uC744 \uBAA8\uB450 \uC9C0\uC6D0\uD55C\uB2E4.\n */\nexport interface DropdownPopupProps extends JSX.HTMLAttributes<HTMLDivElement> {\n  /**\n   * \uBAA8\uBC14\uC77C \uBAA8\uB4DC\uC5D0\uC11C \uB4DC\uB798\uADF8 \uD578\uB4E4 \uD45C\uC2DC \uC5EC\uBD80\n   * @default true\n   */\n  showHandle?: boolean;\n}\n\n/**\n * Dropdown\uC758 \uD31D\uC5C5 \uCF58\uD150\uCE20\uB97C \uB80C\uB354\uB9C1\uD558\uB294 \uCEF4\uD3EC\uB10C\uD2B8\n *\n * \uBC18\uB4DC\uC2DC Dropdown \uCEF4\uD3EC\uB10C\uD2B8 \uB0B4\uBD80\uC5D0\uC11C \uC0AC\uC6A9\uD574\uC57C \uD55C\uB2E4.\n * Portal\uC744 \uD1B5\uD574 document.body\uC5D0 \uB80C\uB354\uB9C1\uB418\uC5B4 z-index \uC2A4\uD0DC\uD0B9 \uC774\uC288\uB97C \uBC29\uC9C0\uD55C\uB2E4.\n *\n * @example\n * ```tsx\n * <Dropdown>\n *   <button>\uBA54\uB274 \uC5F4\uAE30</button>\n *   <DropdownPopup>\n *     <div>\uD31D\uC5C5 \uB0B4\uC6A9</div>\n *   </DropdownPopup>\n * </Dropdown>\n * ```\n */\nexport const DropdownPopup: ParentComponent<DropdownPopupProps> = (props) => {\n  const [local, rest] = splitProps(props, [\"children\", \"class\", \"style\", \"showHandle\"]);\n\n  const ctx = useDropdownInternal();\n  if (!ctx) {\n    throw new Error(\n      \"[DropdownPopup] Dropdown \uCEF4\uD3EC\uB10C\uD2B8 \uB0B4\uBD80\uC5D0\uC11C \uC0AC\uC6A9\uD574\uC57C \uD569\uB2C8\uB2E4.\\n\" +\n      \"DropdownPopup\uC740 \uBC18\uB4DC\uC2DC <Dropdown> \uCEF4\uD3EC\uB10C\uD2B8\uC758 \uC790\uC2DD\uC73C\uB85C \uBC30\uCE58\uD574\uC57C \uD569\uB2C8\uB2E4.\",\n    );\n  }\n\n  const showHandle = createMemo(() => local.showHandle ?? true);\n\n  let popupRef!: HTMLDivElement;\n\n  // \uD31D\uC5C5 \uC5F4\uB9B4 \uB54C \uC2A4\uD0C0\uC77C \uC801\uC6A9 \uBC0F \uD3EC\uCEE4\uC2A4\n  createEffect(() => {\n    if (ctx.open()) {\n      // \uB2E4\uC74C \uD504\uB808\uC784\uC5D0\uC11C \uD3EC\uC9C0\uC158 \uC801\uC6A9 (DOM\uC774 \uB80C\uB354\uB9C1\uB41C \uD6C4)\n      const frameId = requestAnimationFrame(() => {\n        const style = ctx.popupStyle();\n        Object.entries(style).forEach(([key, value]) => {\n          if (value !== undefined) {\n            popupRef.style.setProperty(key, String(value));\n          }\n        });\n        popupRef.focus();\n      });\n      onCleanup(() => cancelAnimationFrame(frameId));\n    }\n  });\n\n  // \uD0A4\uBCF4\uB4DC \uC774\uBCA4\uD2B8\n  const handleKeyDown = (e: KeyboardEvent) => {\n    if (e.key === \"Escape\") {\n      e.preventDefault();\n      e.stopPropagation();\n      ctx.close();\n      return;\n    }\n\n    // \uACBD\uACC4 focusable\uC5D0\uC11C trigger\uB85C \uD3EC\uCEE4\uC2A4 \uC774\uB3D9\n    // placement=\"bottom\": \uCCAB\uBC88\uC9F8 + ArrowUp \u2192 trigger\n    // placement=\"top\": \uB9C8\uC9C0\uB9C9 + ArrowDown \u2192 trigger\n    if (!e.ctrlKey && !e.altKey) {\n      const tabbables = tabbable(popupRef);\n      const shouldFocusTrigger =\n        (ctx.placement() === \"bottom\" && e.key === \"ArrowUp\" && document.activeElement === tabbables[0]) ||\n        (ctx.placement() === \"top\" && e.key === \"ArrowDown\" && document.activeElement === tabbables.at(-1));\n\n      if (shouldFocusTrigger) {\n        e.preventDefault();\n        e.stopPropagation();\n        ctx.focusTrigger();\n      }\n    }\n  };\n\n  return (\n    <Show when={ctx.open()}>\n      <Portal>\n        {/* \uBAA8\uBC14\uC77C \uBC31\uB4DC\uB86D */}\n        <Show when={ctx.isMobile()}>\n          <div class={backdrop} onClick={() => ctx.close()} />\n        </Show>\n\n        {/* \uD31D\uC5C5 \uBCF8\uCCB4 */}\n        <div\n          ref={popupRef}\n          id={`dropdown-popup-${ctx.id}`}\n          data-dropdown-id={ctx.id}\n          role=\"menu\"\n          tabIndex={-1}\n          class={[\n            dropdownPopup({\n              placement: ctx.placement(),\n              mobile: ctx.isMobile(),\n            }),\n            local.class,\n          ]\n            .filterExists()\n            .join(\" \")}\n          style={local.style}\n          onKeyDown={handleKeyDown}\n          {...rest}\n        >\n          {/* \uBAA8\uBC14\uC77C \uB4DC\uB798\uADF8 \uD578\uB4E4 */}\n          <Show when={ctx.isMobile() && showHandle()}>\n            <div class={mobileHandle} />\n          </Show>\n\n          <div class={dropdownPopupContent}>{local.children}</div>\n        </div>\n      </Portal>\n    </Show>\n  );\n};\n"],
  "mappings": "AAAA,OAAO;AACP;AAAA,EAGE;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,OACK;AACP,SAAS,cAAc;AACvB,SAAS,gBAAgB;AACzB;AAAA,EACE;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,OACK;AACP,SAAS,2BAA2B;AAgC7B,MAAM,gBAAqD,CAAC,UAAU;AAC3E,QAAM,CAAC,OAAO,IAAI,IAAI,WAAW,OAAO,CAAC,YAAY,SAAS,SAAS,YAAY,CAAC;AAEpF,QAAM,MAAM,oBAAoB;AAChC,MAAI,CAAC,KAAK;AACR,UAAM,IAAI;AAAA,MACR;AAAA,IAEF;AAAA,EACF;AAEA,QAAM,aAAa,WAAW,MAAM,MAAM,cAAc,IAAI;AAE5D,MAAI;AAGJ,eAAa,MAAM;AACjB,QAAI,IAAI,KAAK,GAAG;AAEd,YAAM,UAAU,sBAAsB,MAAM;AAC1C,cAAM,QAAQ,IAAI,WAAW;AAC7B,eAAO,QAAQ,KAAK,EAAE,QAAQ,CAAC,CAAC,KAAK,KAAK,MAAM;AAC9C,cAAI,UAAU,QAAW;AACvB,qBAAS,MAAM,YAAY,KAAK,OAAO,KAAK,CAAC;AAAA,UAC/C;AAAA,QACF,CAAC;AACD,iBAAS,MAAM;AAAA,MACjB,CAAC;AACD,gBAAU,MAAM,qBAAqB,OAAO,CAAC;AAAA,IAC/C;AAAA,EACF,CAAC;AAGD,QAAM,gBAAgB,CAAC,MAAqB;AAC1C,QAAI,EAAE,QAAQ,UAAU;AACtB,QAAE,eAAe;AACjB,QAAE,gBAAgB;AAClB,UAAI,MAAM;AACV;AAAA,IACF;AAKA,QAAI,CAAC,EAAE,WAAW,CAAC,EAAE,QAAQ;AAC3B,YAAM,YAAY,SAAS,QAAQ;AACnC,YAAM,qBACH,IAAI,UAAU,MAAM,YAAY,EAAE,QAAQ,aAAa,SAAS,kBAAkB,UAAU,CAAC,KAC7F,IAAI,UAAU,MAAM,SAAS,EAAE,QAAQ,eAAe,SAAS,kBAAkB,UAAU,GAAG,EAAE;AAEnG,UAAI,oBAAoB;AACtB,UAAE,eAAe;AACjB,UAAE,gBAAgB;AAClB,YAAI,aAAa;AAAA,MACnB;AAAA,IACF;AAAA,EACF;AAEA,SACE,oCAAC,QAAK,MAAM,IAAI,KAAK,KACnB,oCAAC,cAEC,oCAAC,QAAK,MAAM,IAAI,SAAS,KACvB,oCAAC,SAAI,OAAO,UAAU,SAAS,MAAM,IAAI,MAAM,GAAG,CACpD,GAGA;AAAA,IAAC;AAAA;AAAA,MACC,KAAK;AAAA,MACL,IAAI,kBAAkB,IAAI,EAAE;AAAA,MAC5B,oBAAkB,IAAI;AAAA,MACtB,MAAK;AAAA,MACL,UAAU;AAAA,MACV,OAAO;AAAA,QACL,cAAc;AAAA,UACZ,WAAW,IAAI,UAAU;AAAA,UACzB,QAAQ,IAAI,SAAS;AAAA,QACvB,CAAC;AAAA,QACD,MAAM;AAAA,MACR,EACG,aAAa,EACb,KAAK,GAAG;AAAA,MACX,OAAO,MAAM;AAAA,MACb,WAAW;AAAA,MACV,GAAG;AAAA;AAAA,IAGJ,oCAAC,QAAK,MAAM,IAAI,SAAS,KAAK,WAAW,KACvC,oCAAC,SAAI,OAAO,cAAc,CAC5B;AAAA,IAEA,oCAAC,SAAI,OAAO,wBAAuB,MAAM,QAAS;AAAA,EACpD,CACF,CACF;AAEJ;",
  "names": []
}
