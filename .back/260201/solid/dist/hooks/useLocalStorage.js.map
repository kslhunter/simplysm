{
  "version": 3,
  "sources": ["../../src/hooks/useLocalStorage.ts"],
  "sourcesContent": ["import { createSignal, onCleanup, type Signal } from \"solid-js\";\nimport { useConfig } from \"../contexts/ConfigContext\";\n\n/**\n * useLocalStorage \uC635\uC158\n */\nexport interface UseLocalStorageOptions {\n  /**\n   * localStorage\uC5D0\uC11C \uC77D\uC740 \uAC12\uC744 \uAC80\uC99D\uD558\uB294 \uD568\uC218\n   * false\uB97C \uBC18\uD658\uD558\uBA74 defaultValue\uAC00 \uC0AC\uC6A9\uB41C\uB2E4\n   */\n  validator?: (value: string) => boolean;\n}\n\n/**\n * localStorage\uC640 \uB3D9\uAE30\uD654\uB418\uB294 Signal\uC744 \uC0DD\uC131\uD558\uB294 \uD6C5\n *\n * ConfigProvider\uC758 clientName\uC744 prefix\uB85C \uC0AC\uC6A9\uD558\uC5EC \uD0A4 \uCDA9\uB3CC\uC744 \uBC29\uC9C0\uD55C\uB2E4.\n * \uAC12\uC774 \uBCC0\uACBD\uB420 \uB54C\uB9C8\uB2E4 \uC790\uB3D9\uC73C\uB85C localStorage\uC5D0 \uC800\uC7A5\uB41C\uB2E4.\n *\n * @typeParam T - \uC800\uC7A5\uD560 \uAC12\uC758 \uD0C0\uC785 (string\uC758 \uC11C\uBE0C\uD0C0\uC785\uC774\uC5B4\uC57C \uD568)\n * @param key - localStorage \uD0A4 (clientName\uC774 prefix\uB85C \uBD99\uC74C)\n * @param defaultValue - localStorage\uC5D0 \uAC12\uC774 \uC5C6\uAC70\uB098 \uC720\uD6A8\uD558\uC9C0 \uC54A\uC744 \uB54C \uC0AC\uC6A9\uD560 \uAE30\uBCF8\uAC12\n * @param options - \uC120\uD0DD\uC801 \uC635\uC158 (validator \uB4F1)\n * @returns SolidJS Signal \uD29C\uD50C [getter, setter]\n *\n * @example\n * ```tsx\n * // \uAE30\uBCF8 \uC0AC\uC6A9\uBC95\n * const [theme, setTheme] = useLocalStorage<\"light\" | \"dark\">(\"theme\", \"light\");\n *\n * // validator\uB97C \uC0AC\uC6A9\uD55C \uD0C0\uC785 \uC548\uC804\uD55C \uC0AC\uC6A9\uBC95\n * const [theme, setTheme] = useLocalStorage<\"light\" | \"dark\">(\"theme\", \"light\", {\n *   validator: (v) => v === \"light\" || v === \"dark\",\n * });\n *\n * // \uAC12 \uC77D\uAE30\n * console.log(theme()); // \"light\" \uB610\uB294 \uC800\uC7A5\uB41C \uAC12\n *\n * // \uAC12 \uC124\uC815 (\uC790\uB3D9\uC73C\uB85C localStorage\uC5D0 \uC800\uC7A5)\n * setTheme(\"dark\");\n * ```\n */\nexport function useLocalStorage<T extends string>(\n  key: string,\n  defaultValue: T,\n  options?: UseLocalStorageOptions,\n): Signal<T> {\n  const { clientName } = useConfig();\n  const storageKey = `${clientName}:${key}`;\n\n  const getValidatedValue = (): T => {\n    try {\n      const stored = localStorage.getItem(storageKey);\n\n      // null\uC774\uAC70\uB098 \uBE48 \uBB38\uC790\uC5F4\uC774\uBA74 \uAE30\uBCF8\uAC12 \uBC18\uD658\n      if (stored == null || stored === \"\") {\n        return defaultValue;\n      }\n\n      // validator\uAC00 \uC81C\uACF5\uB418\uBA74 \uAC80\uC99D\n      if (options?.validator) {\n        return options.validator(stored) ? (stored as T) : defaultValue;\n      }\n\n      return stored as T;\n    } catch {\n      // localStorage \uC811\uADFC \uBD88\uAC00 \uC2DC (\uC2DC\uD06C\uB9BF \uBAA8\uB4DC, iframe sandbox \uB4F1) \uAE30\uBCF8\uAC12 \uBC18\uD658\n      return defaultValue;\n    }\n  };\n\n  const [value, setValue] = createSignal<T>(getValidatedValue());\n\n  const setAndPersist = ((v: T | ((prev: T) => T)) => {\n    const next = typeof v === \"function\" ? (v as (prev: T) => T)(value()) : v;\n    setValue(() => next);\n    try {\n      localStorage.setItem(storageKey, next);\n    } catch {\n      // localStorage \uC811\uADFC \uBD88\uAC00 \uC2DC \uBB34\uC2DC (\uAC12\uC740 \uBA54\uBAA8\uB9AC\uC5D0\uB9CC \uC720\uC9C0)\n    }\n    return next;\n  }) as Signal<T>[1];\n\n  // \uB2E4\uB978 \uD0ED\uC5D0\uC11C localStorage \uBCC0\uACBD \uC2DC \uB3D9\uAE30\uD654\n  const handleStorageChange = (e: StorageEvent) => {\n    if (e.key !== storageKey) return;\n    if (e.newValue == null) {\n      setValue(() => defaultValue);\n    } else if (!options?.validator || options.validator(e.newValue)) {\n      setValue(() => e.newValue as T);\n    }\n  };\n\n  if (typeof window !== \"undefined\") {\n    window.addEventListener(\"storage\", handleStorageChange);\n    onCleanup(() => window.removeEventListener(\"storage\", handleStorageChange));\n  }\n\n  return [value, setAndPersist];\n}\n"],
  "mappings": "AAAA,SAAS,cAAc,iBAA8B;AACrD,SAAS,iBAAiB;AA0CnB,SAAS,gBACd,KACA,cACA,SACW;AACX,QAAM,EAAE,WAAW,IAAI,UAAU;AACjC,QAAM,aAAa,GAAG,UAAU,IAAI,GAAG;AAEvC,QAAM,oBAAoB,MAAS;AACjC,QAAI;AACF,YAAM,SAAS,aAAa,QAAQ,UAAU;AAG9C,UAAI,UAAU,QAAQ,WAAW,IAAI;AACnC,eAAO;AAAA,MACT;AAGA,UAAI,mCAAS,WAAW;AACtB,eAAO,QAAQ,UAAU,MAAM,IAAK,SAAe;AAAA,MACrD;AAEA,aAAO;AAAA,IACT,QAAQ;AAEN,aAAO;AAAA,IACT;AAAA,EACF;AAEA,QAAM,CAAC,OAAO,QAAQ,IAAI,aAAgB,kBAAkB,CAAC;AAE7D,QAAM,iBAAiB,CAAC,MAA4B;AAClD,UAAM,OAAO,OAAO,MAAM,aAAc,EAAqB,MAAM,CAAC,IAAI;AACxE,aAAS,MAAM,IAAI;AACnB,QAAI;AACF,mBAAa,QAAQ,YAAY,IAAI;AAAA,IACvC,QAAQ;AAAA,IAER;AACA,WAAO;AAAA,EACT;AAGA,QAAM,sBAAsB,CAAC,MAAoB;AAC/C,QAAI,EAAE,QAAQ,WAAY;AAC1B,QAAI,EAAE,YAAY,MAAM;AACtB,eAAS,MAAM,YAAY;AAAA,IAC7B,WAAW,EAAC,mCAAS,cAAa,QAAQ,UAAU,EAAE,QAAQ,GAAG;AAC/D,eAAS,MAAM,EAAE,QAAa;AAAA,IAChC;AAAA,EACF;AAEA,MAAI,OAAO,WAAW,aAAa;AACjC,WAAO,iBAAiB,WAAW,mBAAmB;AACtD,cAAU,MAAM,OAAO,oBAAoB,WAAW,mBAAmB,CAAC;AAAA,EAC5E;AAEA,SAAO,CAAC,OAAO,aAAa;AAC9B;",
  "names": []
}
