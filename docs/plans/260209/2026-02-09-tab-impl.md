# Tab 컴포넌트 구현 계획

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** 탭 헤더(버튼 바)만 제공하는 언더라인 스타일 Tab 컴포넌트를 구현한다.

**Architecture:** `Tab` + `Tab.Item` compound component 패턴. Context로 선택 상태를 공유하고, `createPropSignal`로 controlled/uncontrolled을 지원한다. RadioGroup 패턴을 기반으로 하되, 스타일은 언더라인 탭 바로 구현한다.

**Tech Stack:** SolidJS, Tailwind CSS, clsx, tailwind-merge, createPropSignal

---

### Task 1: Tab 컴포넌트 파일 생성

**Files:**

- Create: `packages/solid/src/components/navigation/Tab.tsx`

**Step 1: Tab.tsx 작성**

```tsx
import { type JSX, type ParentComponent, createContext, splitProps, useContext } from "solid-js";
import clsx from "clsx";
import { twMerge } from "tailwind-merge";
import { createPropSignal } from "../../utils/createPropSignal";

// --- Context ---

interface TabContextValue {
  value: () => string | undefined;
  select: (value: string) => void;
  size: () => "sm" | "lg" | undefined;
}

const TabContext = createContext<TabContextValue>();

// --- Tab.Item ---

interface TabItemProps {
  value: string;
  disabled?: boolean;
  class?: string;
  children?: JSX.Element;
}

function TabItemInner(props: TabItemProps) {
  const ctx = useContext(TabContext);
  if (!ctx) throw new Error("Tab.Item must be used inside Tab");

  const isSelected = () => ctx.value() === props.value;

  const sizeClasses = () => {
    switch (ctx.size()) {
      case "sm":
        return "px-2.5 py-1 text-sm";
      case "lg":
        return "px-4 py-2.5 text-base";
      default:
        return "px-3 py-1.5 text-sm";
    }
  };

  const baseClass = clsx("relative cursor-pointer select-none font-medium", "transition-colors", "-mb-px");

  const stateClass = () =>
    isSelected()
      ? clsx("border-b-2 border-primary-500 text-primary-600", "dark:border-primary-400 dark:text-primary-400")
      : clsx(
          "border-b-2 border-transparent",
          "text-base-500 hover:text-base-700 hover:border-base-300",
          "dark:text-base-400 dark:hover:text-base-200 dark:hover:border-base-600",
        );

  const disabledClass = "opacity-50 pointer-events-none";

  return (
    <button
      type="button"
      role="tab"
      aria-selected={isSelected()}
      aria-disabled={props.disabled ?? false}
      tabIndex={props.disabled ? -1 : 0}
      class={twMerge(baseClass, sizeClasses(), stateClass(), props.disabled && disabledClass, props.class)}
      onClick={() => {
        if (!props.disabled) {
          ctx.select(props.value);
        }
      }}
      onKeyDown={(e) => {
        if (e.key === " " || e.key === "Enter") {
          e.preventDefault();
          if (!props.disabled) {
            ctx.select(props.value);
          }
        }
      }}
    >
      {props.children}
    </button>
  );
}

// --- Tab ---

interface TabProps {
  value?: string;
  onValueChange?: (value: string) => void;
  size?: "sm" | "lg";
  class?: string;
  style?: JSX.CSSProperties;
  children?: JSX.Element;
}

interface TabComponent {
  (props: TabProps): JSX.Element;
  Item: typeof TabItemInner;
}

const TabInner: ParentComponent<TabProps> = (props) => {
  const [local, rest] = splitProps(props, ["value", "onValueChange", "size", "class", "style", "children"]);

  const [value, setValue] = createPropSignal({
    value: () => local.value,
    onChange: () => local.onValueChange,
  });

  const contextValue: TabContextValue = {
    value,
    select: (v: string) => {
      setValue(v);
    },
    size: () => local.size,
  };

  const baseClass = clsx("inline-flex items-center gap-1", "border-b border-base-200", "dark:border-base-700");

  return (
    <TabContext.Provider value={contextValue}>
      <div {...rest} role="tablist" class={twMerge(baseClass, local.class)} style={local.style}>
        {local.children}
      </div>
    </TabContext.Provider>
  );
};

export const Tab = TabInner as unknown as TabComponent;
Tab.Item = TabItemInner;
```

**Step 2: index.ts에 export 추가**

파일: `packages/solid/src/index.ts`

`// layout` 섹션 바로 위에 navigation 섹션 추가:

```typescript
// navigation
export * from "./components/navigation/Tab";
```

**Step 3: 커밋**

```bash
git add packages/solid/src/components/navigation/Tab.tsx packages/solid/src/index.ts
git commit -m "feat(solid): Tab 컴포넌트 구현"
```

---

### Task 2: Tab 테스트 작성

**Files:**

- Create: `packages/solid/tests/components/navigation/Tab.spec.tsx`

**Step 1: 테스트 파일 작성**

```tsx
import { render, fireEvent } from "@solidjs/testing-library";
import { describe, it, expect, vi } from "vitest";
import { createSignal } from "solid-js";
import { Tab } from "../../../src/components/navigation/Tab";

describe("Tab 컴포넌트", () => {
  describe("기본 렌더링", () => {
    it("tablist role로 렌더링된다", () => {
      const { getByRole } = render(() => (
        <Tab>
          <Tab.Item value="a">A</Tab.Item>
        </Tab>
      ));
      expect(getByRole("tablist")).toBeTruthy();
    });

    it("Tab.Item이 tab role로 렌더링된다", () => {
      const { getByRole } = render(() => (
        <Tab>
          <Tab.Item value="a">A</Tab.Item>
        </Tab>
      ));
      expect(getByRole("tab")).toBeTruthy();
    });

    it("children이 표시된다", () => {
      const { getByText } = render(() => (
        <Tab>
          <Tab.Item value="a">탭 A</Tab.Item>
          <Tab.Item value="b">탭 B</Tab.Item>
        </Tab>
      ));
      expect(getByText("탭 A")).toBeTruthy();
      expect(getByText("탭 B")).toBeTruthy();
    });
  });

  describe("선택 동작", () => {
    it("클릭하면 aria-selected가 true가 된다", () => {
      const { getAllByRole } = render(() => (
        <Tab>
          <Tab.Item value="a">A</Tab.Item>
          <Tab.Item value="b">B</Tab.Item>
        </Tab>
      ));
      const tabs = getAllByRole("tab");

      fireEvent.click(tabs[0]);
      expect(tabs[0].getAttribute("aria-selected")).toBe("true");
      expect(tabs[1].getAttribute("aria-selected")).toBe("false");
    });

    it("다른 탭 클릭 시 선택이 변경된다", () => {
      const { getAllByRole } = render(() => (
        <Tab value="a">
          <Tab.Item value="a">A</Tab.Item>
          <Tab.Item value="b">B</Tab.Item>
        </Tab>
      ));
      const tabs = getAllByRole("tab");

      fireEvent.click(tabs[1]);
      expect(tabs[1].getAttribute("aria-selected")).toBe("true");
      expect(tabs[0].getAttribute("aria-selected")).toBe("false");
    });

    it("disabled 탭은 클릭해도 선택되지 않는다", () => {
      const handleChange = vi.fn();
      const { getAllByRole } = render(() => (
        <Tab onValueChange={handleChange}>
          <Tab.Item value="a">A</Tab.Item>
          <Tab.Item value="b" disabled>
            B
          </Tab.Item>
        </Tab>
      ));

      fireEvent.click(getAllByRole("tab")[1]);
      expect(handleChange).not.toHaveBeenCalled();
    });
  });

  describe("키보드 동작", () => {
    it("Space 키로 선택된다", () => {
      const { getAllByRole } = render(() => (
        <Tab>
          <Tab.Item value="a">A</Tab.Item>
          <Tab.Item value="b">B</Tab.Item>
        </Tab>
      ));

      fireEvent.keyDown(getAllByRole("tab")[0], { key: " " });
      expect(getAllByRole("tab")[0].getAttribute("aria-selected")).toBe("true");
    });

    it("Enter 키로 선택된다", () => {
      const { getAllByRole } = render(() => (
        <Tab>
          <Tab.Item value="a">A</Tab.Item>
          <Tab.Item value="b">B</Tab.Item>
        </Tab>
      ));

      fireEvent.keyDown(getAllByRole("tab")[1], { key: "Enter" });
      expect(getAllByRole("tab")[1].getAttribute("aria-selected")).toBe("true");
    });
  });

  describe("controlled 패턴", () => {
    it("value prop이 선택 상태로 반영된다", () => {
      const { getAllByRole } = render(() => (
        <Tab value="b">
          <Tab.Item value="a">A</Tab.Item>
          <Tab.Item value="b">B</Tab.Item>
        </Tab>
      ));

      expect(getAllByRole("tab")[0].getAttribute("aria-selected")).toBe("false");
      expect(getAllByRole("tab")[1].getAttribute("aria-selected")).toBe("true");
    });

    it("onValueChange가 클릭 시 호출된다", () => {
      const handleChange = vi.fn();
      const { getAllByRole } = render(() => (
        <Tab value="a" onValueChange={handleChange}>
          <Tab.Item value="a">A</Tab.Item>
          <Tab.Item value="b">B</Tab.Item>
        </Tab>
      ));

      fireEvent.click(getAllByRole("tab")[1]);
      expect(handleChange).toHaveBeenCalledWith("b");
    });

    it("외부 상태 변경 시 업데이트된다", () => {
      const [value, setValue] = createSignal("a");
      const { getAllByRole } = render(() => (
        <Tab value={value()} onValueChange={setValue}>
          <Tab.Item value="a">A</Tab.Item>
          <Tab.Item value="b">B</Tab.Item>
        </Tab>
      ));

      expect(getAllByRole("tab")[0].getAttribute("aria-selected")).toBe("true");

      setValue("b");
      expect(getAllByRole("tab")[1].getAttribute("aria-selected")).toBe("true");
      expect(getAllByRole("tab")[0].getAttribute("aria-selected")).toBe("false");
    });
  });

  describe("사이즈", () => {
    it("size prop에 따라 스타일이 달라진다", () => {
      const { getAllByRole: getDefault } = render(() => (
        <Tab>
          <Tab.Item value="a">A</Tab.Item>
        </Tab>
      ));
      const { getAllByRole: getSm } = render(() => (
        <Tab size="sm">
          <Tab.Item value="a">A</Tab.Item>
        </Tab>
      ));

      expect(getDefault("tab")[0].className).not.toBe(getSm("tab")[0].className);
    });
  });

  describe("접근성", () => {
    it("disabled 탭에 aria-disabled가 설정된다", () => {
      const { getAllByRole } = render(() => (
        <Tab>
          <Tab.Item value="a">A</Tab.Item>
          <Tab.Item value="b" disabled>
            B
          </Tab.Item>
        </Tab>
      ));

      expect(getAllByRole("tab")[1].getAttribute("aria-disabled")).toBe("true");
    });

    it("disabled 탭의 tabIndex가 -1이다", () => {
      const { getAllByRole } = render(() => (
        <Tab>
          <Tab.Item value="a">A</Tab.Item>
          <Tab.Item value="b" disabled>
            B
          </Tab.Item>
        </Tab>
      ));

      expect(getAllByRole("tab")[1].getAttribute("tabindex")).toBe("-1");
    });
  });

  describe("class 병합", () => {
    it("Tab에 사용자 정의 class가 병합된다", () => {
      // eslint-disable-next-line tailwindcss/no-custom-classname
      const { getByRole } = render(() => (
        <Tab class="my-tab-class">
          <Tab.Item value="a">A</Tab.Item>
        </Tab>
      ));
      expect(getByRole("tablist").classList.contains("my-tab-class")).toBe(true);
    });

    it("Tab.Item에 사용자 정의 class가 병합된다", () => {
      // eslint-disable-next-line tailwindcss/no-custom-classname
      const { getByRole } = render(() => (
        <Tab>
          <Tab.Item value="a" class="my-item-class">
            A
          </Tab.Item>
        </Tab>
      ));
      expect(getByRole("tab").classList.contains("my-item-class")).toBe(true);
    });
  });
});
```

**Step 2: 테스트 실행**

```bash
pnpm vitest packages/solid/tests/components/navigation/Tab.spec.tsx --project=solid --run
```

Expected: 모든 테스트 PASS

**Step 3: 커밋**

```bash
git add packages/solid/tests/components/navigation/Tab.spec.tsx
git commit -m "test(solid): Tab 컴포넌트 테스트 추가"
```

---

### Task 3: 데모 페이지 추가

**Files:**

- Create: `packages/solid-demo/src/pages/navigation/TabPage.tsx`
- Modify: `packages/solid-demo/src/pages/Home.tsx` (메뉴 항목 추가)
- Modify: `packages/solid-demo/src/main.tsx` (라우트 추가)

**Step 1: TabPage.tsx 작성**

```tsx
import { createSignal } from "solid-js";
import { Show } from "solid-js";
import { Tab, Topbar } from "@simplysm/solid";

export default function TabPage() {
  const [tab1, setTab1] = createSignal("general");
  const [tab2, setTab2] = createSignal("a");

  return (
    <Topbar.Container>
      <Topbar>
        <h1 class="m-0 text-base">Tab</h1>
      </Topbar>
      <div class="flex-1 overflow-auto p-6">
        <div class="space-y-12">
          {/* 기본 사용 */}
          <section>
            <h2 class="mb-6 text-2xl font-bold">기본 사용</h2>
            <div class="space-y-4">
              <Tab value={tab1()} onValueChange={setTab1}>
                <Tab.Item value="general">일반</Tab.Item>
                <Tab.Item value="advanced">고급</Tab.Item>
                <Tab.Item value="about">정보</Tab.Item>
              </Tab>
              <div class="rounded border border-base-200 p-4 dark:border-base-700">
                <Show when={tab1() === "general"}>
                  <p>일반 설정 내용입니다.</p>
                </Show>
                <Show when={tab1() === "advanced"}>
                  <p>고급 설정 내용입니다.</p>
                </Show>
                <Show when={tab1() === "about"}>
                  <p>정보 페이지입니다.</p>
                </Show>
              </div>
              <p class="text-sm text-base-600 dark:text-base-400">
                선택: <code class="rounded bg-base-200 px-1 dark:bg-base-700">{tab1()}</code>
              </p>
            </div>
          </section>

          {/* Disabled */}
          <section>
            <h2 class="mb-6 text-2xl font-bold">Disabled</h2>
            <Tab value="a">
              <Tab.Item value="a">활성</Tab.Item>
              <Tab.Item value="b" disabled>
                비활성
              </Tab.Item>
              <Tab.Item value="c">활성</Tab.Item>
            </Tab>
          </section>

          {/* 사이즈 */}
          <section>
            <h2 class="mb-6 text-2xl font-bold">사이즈</h2>
            <div class="space-y-6">
              <div>
                <h3 class="mb-3 text-lg font-semibold">Small</h3>
                <Tab size="sm" value={tab2()} onValueChange={setTab2}>
                  <Tab.Item value="a">탭 A</Tab.Item>
                  <Tab.Item value="b">탭 B</Tab.Item>
                  <Tab.Item value="c">탭 C</Tab.Item>
                </Tab>
              </div>
              <div>
                <h3 class="mb-3 text-lg font-semibold">Default</h3>
                <Tab value={tab2()} onValueChange={setTab2}>
                  <Tab.Item value="a">탭 A</Tab.Item>
                  <Tab.Item value="b">탭 B</Tab.Item>
                  <Tab.Item value="c">탭 C</Tab.Item>
                </Tab>
              </div>
              <div>
                <h3 class="mb-3 text-lg font-semibold">Large</h3>
                <Tab size="lg" value={tab2()} onValueChange={setTab2}>
                  <Tab.Item value="a">탭 A</Tab.Item>
                  <Tab.Item value="b">탭 B</Tab.Item>
                  <Tab.Item value="c">탭 C</Tab.Item>
                </Tab>
              </div>
            </div>
          </section>
        </div>
      </div>
    </Topbar.Container>
  );
}
```

**Step 2: Home.tsx에 메뉴 항목 추가**

`Feedback` 섹션 바로 위에 Navigation 섹션 추가:

```typescript
{
  title: "Navigation",
  icon: IconLayoutSidebar,  // 기존 import 재사용
  children: [
    { title: "Tab", href: "/home/navigation/tab" },
  ],
},
```

**Step 3: main.tsx에 라우트 추가**

Disclosure 라우트 그룹 아래에 추가:

```typescript
<Route path="/home/navigation/tab" component={lazy(() => import("./pages/navigation/TabPage"))} />
```

**Step 4: 커밋**

```bash
git add packages/solid-demo/src/pages/navigation/TabPage.tsx packages/solid-demo/src/pages/Home.tsx packages/solid-demo/src/main.tsx
git commit -m "feat(solid-demo): Tab 데모 페이지 추가"
```

---

### Task 4: 검증

**Step 1: 타입체크**

```bash
pnpm typecheck packages/solid packages/solid-demo
```

Expected: 에러 없음

**Step 2: 린트**

```bash
pnpm lint packages/solid packages/solid-demo
```

Expected: 에러 없음

**Step 3: 테스트**

```bash
pnpm vitest packages/solid/tests/components/navigation/Tab.spec.tsx --project=solid --run
```

Expected: 모든 테스트 PASS

**Step 4: 데모 확인 (수동)**

```bash
pnpm dev
```

브라우저에서 Navigation > Tab 메뉴 접근하여 동작 확인

**Step 5: 수정 필요 시 수정 후 커밋**

```bash
git add -A
git commit -m "fix(solid): Tab 컴포넌트 검증 수정"
```
