---
name: sd-plan
description: "사용자의 요청을 바탕으로 기획서를 작성하고, 질문을 통해 기획서를 완성하는 스킬"
argument-hint: "[기획서.md 경로]"
model: inherit
---

# 기획 스킬

사용자의 요청을 바탕으로 기획서를 작성하고, 불확실한 점과 결정사항을 하나씩 질문하며 기획서를 완성한다.

## 인자

- `$ARGUMENTS` (선택): 기존 기획서 md 파일 경로
  - 지정 시: 해당 파일이 기획서(`_sd-output/plans/`)라면 작업 흐름 3번부터 시작 (그 외에는 요청문서로 봄)
  - 미지정 시: 작업 흐름 1번부터 시작

## 작업 흐름

### 1. 기획하기 (인자가 없을 때만)

- 사용자의 요청을 청취하고 요구사항을 파악한다.
- 기획의 목적, 범위, 주요 기능을 정리한다.

### 2. 기획서 초안 작성 (인자가 없을 때만)

- 기획 내용을 바탕으로 기획서 초안을 md 파일로 작성한다.
- 파일 위치: `_sd-output/plans/{{yyyyMMdd}}_{{기획제목-kebab-case}}_{{seq++}}.md`
  - seq: 동일 파일이 존재할 경우만 순번지정
  - 예: "solid 패키지의 리뷰에 따른 수정 적용" → `_sd-output/plans/260203_solid_review_fixes.md`
- 기획서에는 다음 섹션을 포함한다:
  - `## 개요`: 기획 배경 및 목적
  - `## 범위`: 기획 범위 및 제외 사항
  - `## 주요 기능`: 핵심 기능 목록 및 설명
  - `## 결정사항`: 확정된 결정사항 이력 (초기에는 비워둠)
  - `## 미결 사항`: 추가 논의가 필요한 항목

### 3. 기획서 분석 및 질문

기획서를 분석하며 다음 유형의 항목을 식별하고 **하나씩** 질문한다:

- **불확실한 점**: 명확하지 않거나 해석의 여지가 있는 내용
- **결정 필요 사항**: 여러 선택지 중 결정이 필요한 내용 (이미 결정된 사항은 제외)
- **문제점/개선점**: 기획서 자체의 논리적 오류, 누락, 개선 가능 사항

#### 질문 규칙

1. **한 번에 하나씩만** 처리한다.
2. 질문 전에 **전체 질문 목록을 먼저 파악**하고, 진행 상황을 표시한다.
3. **텍스트로 상세 내용을 제시**한다 (도구 사용 아님):
   ```
   [질문 2/5] OOO에 대해 결정이 필요합니다.

   [배경] 현재 기획서에는 OOO가 명확하지 않습니다.

   [권장안] AAA 방식을 권장합니다.
   - 이유 1: ...
   - 이유 2: ...

   [대안] BBB 방식도 가능합니다.
   - 장점: ...
   - 단점: ...
   ```
4. **`AskUserQuestion` 도구로 선택을 요청**한다:
   - 권장안을 첫 번째 선택지에 배치하고 "(권장)" 표시
   - 선택지는 간결하게 (상세 설명은 3번에서 이미 제시됨)
5. 사용자의 답변에 대해 **한 번 더 판단**한다.
   - 논리적으로 맞지 않거나 추가 확인이 필요하면 되묻는다.
   - 문제가 없으면 다음 질문으로 진행한다.
6. 모든 질문이 완료될 때까지 반복한다.

### 4. 기획서 갱신

모든 질문이 완료되면 기획서 md 파일을 갱신한다:

- 질문을 통해 확정된 결정사항들이 `## 결정사항` 섹션에 반영되었는지 확인
- 결정사항에 따라 본문 내용(개요, 범위, 주요 기능 등)도 함께 수정
- `## 미결 사항` 섹션에서 해결된 항목 제거
- 갱신된 기획서 내용을 사용자에게 요약 보고

### 5. 기획서 완성 확인

기획서 갱신 후 사용자에게 다음을 확인한다:

```
기획서가 완성되었습니다.

다음 중 선택해 주세요:
1. 기획서 재리뷰 (분석/질문/완성 과정 재수행)
2. 수정 실행 (계획서에 따라 코드 수정 진행)
3. 완료
```

- "기획서 재리뷰" 선택 시: 작업 흐름 3번으로 돌아가 전체 과정 재수행
- "수정 실행" 선택 시: 새 세션에서 진행하라는 안내 출력 (프롬프트 예시: `/sd-plan-dev {{파일명}}.md`)
- "완료" 선택 시: 스킬 종료

## 질문 시 유의사항

- 질문은 `AskUserQuestion` 도구를 사용한다.
- 권장안을 선택지의 첫 번째에 배치하고 "(권장)" 표시를 한다.
- 질문의 맥락과 배경을 충분히 설명한 후 질문한다.
- 사용자의 도메인 지식을 존중하되, 기술적/논리적 오류는 지적한다.
